---
title: Odoo - Premier modèle
description: Odoo model
---
import { Aside, FileTree, Tabs, TabItem, } from '@astrojs/starlight/components';

Dans ce TD vous allez créez une application de gestion de tâches.
L'objectif est de comprendre les bases de la création d'un module dans Odoo.

Cet exercice s’inspire du livre 
*Daniel Reis, Odoo 11 Development Essentials - Third Edition, Packt, March 2018.*

## Repartir sur une nouvelle instance

Avant de créer votre propre module, démarrez avec une **instance Odoo propre**, sans les modules *Contacts* ni *Project*.

Pour cela, **supprimez les conteneurs existants** puis **recréez-les** à l’aide des commandes Docker adéquates.
Cela vous permettra de repartir d’un environnement vierge, idéal pour le développement du nouveau module.

## Commande de création

L’utilitaire **`odoo-bin.py`** , consultable dans le code source d'Odoo, 
est un outil en ligne de commande qui permet d’interagir avec Odoo 
de différentes manières, notamment pour **créer un nouveau module**.
Cet utilitaire possède plusieurs fonction comme celle de créer un nouveau module.

Dans le conteneur Docker pour interagir avec le serveur, on n'utilise pas **`odoo-bin.py`** 
mais le binaire **`odoo`**,  placé
dans le conteneur au chemin `/usr/bin` pour gérer cette interaction.

<Aside>
Les prochaines étapes consistent à interagir avec le dossier `/mnt/extra-addons/todo_app` du conteneur. 
Si durant ces étapes vous obtenez une erreur `PermissionError: [Errno 13] Permission denied: /mnt/extra-addons/todo_app`, cela signifie que le conteneur 
Odoo n’a pas les droits d’écriture sur le dossier monté `/path/to/addon`.
Pour corriger cela, donnez les droits d’accès à ce dossier via par exemple la commande
`docker exec -ti --user root odoo chmod -R 777 /mnt/extra-addons/todo_app`
</Aside>

Dans un terminal exécutez la commande permettant de créer un nouveau module :

```bash
docker exec -it odoo odoo scaffold todo_app /mnt/extra-addons
```

| Élément | Description |
|----------|-------------|
| `docker exec -it odoo` | Exécute une commande à l’intérieur du conteneur **nommé `odoo`**, en mode interactif (`-it`). |
| `odoo scaffold` | Lance l’utilitaire d’Odoo pour **générer la structure d’un nouveau module**. |
| `todo_app` | Nom du nouveau module à créer. |
| `/mnt/extra-addons` | Chemin à l’intérieur du conteneur où le module sera généré. Il correspond au dossier local `/path/to/addon` monté sur la machine hôte. |


Les différentes options de l'étape de *Scaffolding* sont décrites dans la documentation :
[https://www.odoo.com/documentation/18.0/fr/developer/reference/cli.html#reference-cmdline-scaffold](https://www.odoo.com/documentation/18.0/fr/developer/reference/cli.html#reference-cmdline-scaffold)

Dans le dossier local, vous devriez voir apparaître le dossier **todo_app** contenant

<FileTree>
- \_\_init\_\_.py
- \_\_manifest\_\_.py
- controllers
   - controllers.py
   - \_\_init\_\_.py
- demo
   -  demo.xml
- models
   -  \_\_init\_\_.py
   -  models.py
- security
   -  ir.model.access.csv
- views
   -  templates.xml
   -  views.xml
</FileTree>

## Le fichier manifest

Le fichier `__manifest__.py` est un **fichier de métadonnées** essentiel pour tout module Odoo. 
Il s'agit d'un dictionnaire Python.
Les clés du dictionnaire (`'name'`, `'version'`, `'depends'`, `'data'`, ...) décrivent les métadonnées et la configuration du module.
Les valeurs peuvent être des chaînes de caractères, des listes, des booléens,...

Odoo lit ce dictionnaire au moment du **chargement** du module pour savoir comment installer et configurer le module.
Il informe Odoo sur :

- Le **nom** du module (`'name'`);
- La **version** du module (`'version'`);
- La **description** (`'summary'` ou `'description'`);
- L’**auteur** ou l’entreprise qui développe le module (`'author'`);
- Les **dépendances** sur d’autres modules (`'depends'`);
- Les **fichiers à charger** : vues, données, sécurité, ... (`'data'`).

Des indications pour renseigner si le module est **installable** (`'installable': True,`) 
ou si le module est une **application** (`'application' : True,`) peuvent être ajoutées.

La version générée de ce fichier est présentée ci-dessous, mais toutes les clés possibles 
sont décrites dans la [documentation](https://www.odoo.com/documentation/18.0/fr/developer/reference/backend/module.html?highlight=manifest).

```python title="__manifest__.py"
# -*- coding: utf-8 -*-
{
    'name': "todo_app",

    'summary': "Short (1 phrase/line) summary of the module's purpose",

    'description': """
Long description of module's purpose
    """,

    'author': "My Company",
    'website': "https://www.yourcompany.com",

    # Categories can be used to filter modules in modules listing
    # Check https://github.com/odoo/odoo/blob/15.0/odoo/addons/base/data/ir_module_category_data.xml
    # for the full list
    'category': 'Uncategorized',
    'version': '0.1',

    # any module necessary for this one to work correctly
    'depends': ['base'],

    # always loaded
    'data': [
        # 'security/ir.model.access.csv',
        'views/views.xml',
        'views/templates.xml',
    ],
    # only loaded in demonstration mode
    'demo': [
        'demo/demo.xml',
    ],
}

```

<Aside icon="pencil" title="Exercice">
Mettez à jour le manifest avec :

- un **nom clair** (`'Todo App'`);
- un numéro de **version** (par exemple `'1.0'`);
- une **description courte et compréhensible**;
- les clés **installable** et **application** à la valeur `True`.

Aucune autre dépendances à part celle au module `['base']` n'est nécessaire.
Les fichiers XML de `'data'`  et `'demo'` restent inchangés.
</Aside>

## Activer le mode développeur

Si vous ne trouvez pas votre application **todo_app** dans la liste des applications à installer, 
c’est normal : Odoo n’a pas encore **rafraîchi la liste des modules disponibles**.

Pour y remédier, il faut activer le **mode développeur**, qui donne accès à des options avancées : 

1. Dans votre navigateur, ajoutez le paramètre de requête `?debug=1` à l’URL actuelle d’Odoo.  
   Par exemple :  [http://localhost:8069/odoo/apps?debug=1](http://localhost:8069/odoo/apps?debug=1)

2. Rechargez la page et constatez l'apparition de nouveaux boutons dans le module des **Applications** :
   - **Update Apps List**
   - **Apply Scheduled Upgrades**
   - **Import modules**

3. Cliquez sur **Update Apps List** pour forcer Odoo à rechercher les nouveaux modules présents dans le répertoire des `/mnt/extra-addons`.

4. Une fois la liste mise à jour, recherchez de nouveau **todo_app** et installez-le en cliquant sur **Activate**.

<Aside icon="pencil" title="Exercice">

Changez la clé application à la valeur False (`'application' : False,`) dans votre manifest, 
cliquez sur **Update Apps List**
et essayez à nouveau de chercher votre
application via le tableau de bord. Que se passe-t-il ?

N'oubliez de remettre la clé à la valeur True une fois votre test terminé (`'application' : True,`).

</Aside>

## Icône du module

Afin de distinguer votre application facilement dans le tableau de bord
et afin de comprendre l'utilité du dossier **static**, vous allez ajouter une icône
associée à votre application :

1. Dans le dossier de votre module créez le dossier `static/description`;
1. Copiez-y une image, par exemple `icon.png` fournie sur la page PoEsi;
1. Ajoutez dans le manifest la clé `'images': ['static/description/icon.png'],`
1. Cliquez sur **Update Apps List** pour mettre à jour l'application;
1. Mettez à jour votre module;
1. Vérifiez que l’icône apparaît dans la liste des modules.

## Création du modèle `TodoTask`

Le fichier `models/models.py` de votre module fraîchement généré 
contient le code décrivant la **structure des modèles de données** d’Odoo.

```python title="models/models.py"
# -*- coding: utf-8 -*-

# from odoo import models, fields, api


# class todo_app(models.Model):
#     _name = 'todo_app.todo_app'
#     _description = 'todo_app.todo_app'

#     name = fields.Char()
#     value = fields.Integer()
#     value2 = fields.Float(compute="_value_pc", store=True)
#     description = fields.Text()
#
#     @api.depends('value')
#     def _value_pc(self):
#         for record in self:
#             record.value2 = float(record.value) / 100
```

Nous n'utiliserons pas ce fichier par la suite et créerons nos propres fichiers modèles.

<Aside icon="open-book" title="Points clés à retenir">
Après une première lecture du fichier `models/models.py`, vous pouvez constater que :
- le **modèle** (ou *Business Object*) est une **classe Python** qui hérite de `models.Model`;
- les attributs "protégés", comme `_name` ou `_description`, permettent à Odoo d’identifier et de décrire le modèle;
- les champs de données sont définis à l’aide des méthodes du module `fields` (`fields.Char()`, `fields.Float()`, ....);
- les méthodes du modèle peuvent être enrichies à l’aide de **décorateurs**, comme `@api.depends('field_name')`, pour réagir à des changements de valeurs.
</Aside>


Commencez par créer le modèle principal de l’application `todo_app` en suivant les étapes
suivantes :
1. Dans le dossier `models` de votre module, créez un fichier nommé **`todo_task_model.py`**.  
1. Dans le fichier `__init__.py` du dossier `models`, importez ce nouveau module :
   ```python title="models/__init__.py"
   from . import todo_task_model
   ```
1. Ajoutez ensuite la définition de la classe **TodoTask** dans `todo_task_model.py` :
   ```python title="models/todo_task_model.py"
   from odoo import models, fields

   class TodoTask(models.Model):
      _name = "todo.task"
      _description = "To-Do Task"
   ```
1. Dans le tableau de bord des applications, ouvrez la fiche de **todo_app** via l'option **Module info**
et cliquez sur le bouton **Upgrade** pour mettre à jour le module.

Les attributs protégés `_name` et `_description` permettent à Odoo d'identifier le modèle 
dans la base de données et de fournir un libellé lisible dans l'interface. 
`_name` définit le **nom technique** du modèle, 
tandis que `_description` décrit son rôle pour les utilisateurs.

<Aside>
En Odoo, la convention de nommage pour le **nom technique d’un modèle** (`_name`) 
utilise généralement le format `module.nom_du_modele` (par exemple `todo.task`).  
Cela permet d’**éviter les conflits** entre modules et de clairement identifier 
à quel module appartient chaque modèle.
</Aside>

Ce modèle constitue la base de données principale de votre application **todo_app**.

## Consultation de la structure d'un modèle

<Aside>
Si ce n'est pas déjà fait activez le mode développeur pour la suite.
</Aside>

Après avoir mis à jour votre module, vous pouvez vérifier qu’Odoo 
a bien créé la table correspondant à votre modèle **todo.task**.

1. Ouvrez l’application **Settings**;
1. Dans le menu **Technical**, sélectionnez **Database Structure > Models**;
1. Recherchez le modèle via son nom technique **todo.task** pour en consulter les détails.

Comme aucun champ personnalisé n’a encore été ajouté, la table ne contient 
que les **champs de base hérités** de `models.Model`.
Ces champs assurent l’identification et le suivi des actions effectuées par les utilisateurs :

| Champ | Description |
|--------|-------------|
| `id` | Identifiant unique de chaque enregistrement. |
| `create_date` | Date et heure de création de l’enregistrement. |
| `create_uid` | Identifiant de l’utilisateur ayant créé l’enregistrement. |
| `write_date` | Date et heure de la dernière modification. |
| `write_uid` | Identifiant de l’utilisateur ayant effectué la dernière modification. |
| `display_name` | Libellé lisible du modèle, utilisé pour les affichages dans l’interface Odoo. |

Ces champs sont automatiquement gérés par Odoo et présents dans **tous les modèles** dérivés de `models.Model`.

## Ajouter un attribut au modèle

Commencez par ajouter un **champ `name`** à votre modèle `todo.task`.
Ce champ permettra de **nommer chaque tâche** et ne doit pas être confondu avec l'attribut `_name` 
de la classe, qui définit le **nom technique du modèle**.

Dans le fichier `todo_task_model.py`, ajoutez le champ `name` à votre classe `TodoTask` en déclarant :

- `name` comme un champ de type **Char** via `fields.Char()`.
- `string="Task Name"` pour définir le **libellé lisible** dans l’interface.
- `required=True` pour rendre le champ **obligatoire**.
   ```python title="models/todo_task_model.py"
   from odoo import models, fields

   class TodoTask(models.Model):
      _name = "todo.task"
      _description = "To-Do Task"

      name = fields.Char(string="Task Name", required=True)
   ```

Mettez à jour le module via la fiche de l'application et vérifiez 
la structure des données via le menu **Technical > Database Structure > Models**.

D’autres options courantes existent pour `fields.Char()`, comme :
- `size=50` : limite le nombre de caractères;
- `default="valeur"` : valeur par défaut pour le champ;
- `help="Texte explicatif"` : texte d’aide affiché à l’utilisateur.


<Aside icon="pencil" title="Exercice">

Consultez la documentation concernant les champs possible via [https://www.odoo.com/documentation/18.0/developer/reference/backend/orm.html#fields](https://www.odoo.com/documentation/18.0/developer/reference/backend/orm.html#fields)

Ensuite modifiez la classe `todo.task` afin qu'elle soit composée des attributs suivants : 

| Nom du champ      | Type     | Description                        | Défaut | Obligatoire |
|--------------------|----------|------------------------------------|---------|--------------|
| `name`             | Char     | Nom de la tâche                    | -       | Oui |
| `is_done`          | Boolean  | Tâche terminée ?                   | -       | Non |
| `active`           | Boolean  | Tâche affichée ?                   | True    | Non |
| `date_deadline`    | Date     | Date limite                        | -       | Non |

Mettez à jour votre module et **vérifiez** la présence de ces champs en consultant la structure des données. 
</Aside>