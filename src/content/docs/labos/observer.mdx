---
title: Odoo - Observateur-Observ√©
description: Docs intro
---
import { Aside, FileTree, Tabs, TabItem, } from '@astrojs/starlight/components';

![Description de l'image](../../../assets/work-in-progress.jpeg)


{/* 

# Contraintes et donn√©es d'installation

> **Cours** : Laboratoire de D√©veloppement collaboratif  
> **Ann√©e acad√©mique** : 2022‚Äì2023  
> **Code** : ERPG5  
> **Enseignants** : JLC - SDR  

---

## Consignes g√©n√©rales

Toutes les informations n√©cessaires √† la r√©alisation des exercices sont disponibles dans le cours th√©orique :

- [D√©veloppement d'un module : H√©ritage, Contraintes et Vues Avanc√©es](https://poesi.esi-bru.be/mod/amanote/view.php?id=781)

Les informations compl√©mentaires sont accessibles via la documentation :

- [Mod√®le, attributs, m√©thodes](https://www.odoo.com/documentation/17.0/developer/reference/backend/orm.html)
- [Les fichiers](https://www.odoo.com/documentation/17.0/developer/reference/backend/data.html)

---

## 1. Mise √† jour du mod√®le

### Observateur / Observ√©

Modifiez la classe `TodoTask` du sous-module `todo_stage` pour que, lors de la mise √† jour d'une t√¢che, si le responsable est modifi√© :

- la relation avec les membres de l'√©quipe soit effac√©e ;
- le message d'alerte suivant soit affich√© : `Please choose a new Team`.

Consultez la [documentation du d√©corateur `onchange`](https://www.odoo.com/documentation/14.0/developer/reference/addons/orm.html#odoo.api.onchange) pour r√©aliser cette mise √† jour.

### Contrainte

#### Nom d‚Äôun tag unique

Consultez la [documentation sur les contraintes SQL](https://www.odoo.com/documentation/14.0/developer/reference/addons/orm.html#odoo.models.BaseModel._sql_constraints).  
Ajoutez ensuite une contrainte pour que le **nom d‚Äôun tag soit unique**.

#### Nom d‚Äôune t√¢che explicite

Consultez la [documentation sur les contraintes de mod√®le](https://www.odoo.com/documentation/14.0/developer/reference/addons/orm.html#odoo.api.constrains).  
Ajoutez ensuite une contrainte au mod√®le `TodoTask` pour que le **nom d‚Äôune t√¢che contienne au minimum 5 caract√®res**.

---

## 2. Importer des donn√©es

Lors de l'installation de votre sous-module `todo_stage`, on souhaite charger des donn√©es de base dans la base de donn√©es.

> üí° **Attention** : Comme vous allez charger des donn√©es dans la base de donn√©es sur lesquelles il existe des contraintes, il est possible que les donn√©es entrent en conflit avec des donn√©es existantes.  
> Soyez attentif au contenu des messages d‚Äôerreurs lors de la mise √† jour du module.

### Nettoyer le fichier demo.xml

Nettoyez le fichier `demo/demo.xml` pour qu'il ressemble √† ceci :

```xml
<odoo>
  <data noupdate="1">

  </data>
</odoo>
```

Consultez la [documentation sur `noupdate`](https://www.odoo.com/documentation/14.0/reference/data.html) pour conna√Ætre l'utilit√© de cette option.

---

### Ins√©rer un tag

Pour ins√©rer une ligne dans la table des `tags`, ajoutez :

```xml
<record model="todo.task.tag" id="todo_task_tag_01">
  <field name="name">un joli nom de tag</field>
</record>
```

Ajoutez dans le fichier `demo.xml` les trois tags suivants :

| model | id | name |
|--------|----|------|
| `todo.task.tag` | `todo_task_tag_01` | Technical |
| `todo.task.tag` | `todo_task_tag_02` | Canceled |
| `todo.task.tag` | `todo_task_tag_03` | Urgent |

Mettez √† jour votre module et v√©rifiez la pr√©sence des nouvelles donn√©es.

---

### Ins√©rer un partenaire

Pour ins√©rer une ligne dans la table `res.partner` :

```xml
<record model="res.partner" id="todo_partner_01">
  <field name="name">un joli nom de partenaire</field>
</record>
```

Ajoutez dans le fichier `demo.xml` les trois partenaires suivants :

| model | id | name |
|--------|----|------|
| `res.partner` | `todo_partner_01` | Patrick Star |
| `res.partner` | `todo_partner_02` | Squidward Tentacles |
| `res.partner` | `todo_partner_03` | Sandy Cheeks |

Seul le champ `name` doit √™tre rempli pour notre module.  
Les autres champs de `res.partner` seront compl√©t√©s avec les valeurs par d√©faut.

Mettez √† jour votre module et v√©rifiez la pr√©sence de vos nouvelles donn√©es.

> ‚ö†Ô∏è L‚Äô√©tape suivante est plus complexe techniquement.

---

### Description d'une t√¢che

Ajoutez une t√¢che dont voici les propri√©t√©s :

- **name** : Reinstall Odoo
- **user_id** : rechercher l‚Äôid de l‚Äôutilisateur `eugene.krabs@he2b.be`
- **date_deadline** : dans 4 jours
- **is_done** : faux
- **effort_estimate** : 5
- **state** : draft
- **desc** : Reinstall ODOO and update to 14.0
- **tag_ids** : Technical
- **team_ids** : Patrick Star, Squidward Tentacles et Sandy Cheeks
- **image** : l‚Äôimage 6
- **docs** : la page web ci-dessous

```html
<h2>Installation requirements</h2>
<ul>
  <li>postgres</li>
  <li>python 3.5</li>
  <li>less</li>
  <li>WkHtmlToPdf</li>
</ul>
```

---

#### Remarque 1 : Rechercher la valeur d‚Äôun champ

```xml
<field name="user_id" search="[('login','=','eugene.krabs@he2b.be')]"/>
```

#### Remarque 2 : Ins√©rer une relation

```xml
<field name="tag_ids" eval="[(4, ref('todo_task_tag_01'), None)]"></field>
```

#### Remarque 3 : Ins√©rer une image

```xml
<field name="image" type="base64" file="todo_stage/static/img/task04.png"/>
```

#### Remarque 4 : Ins√©rer une page HTML

```xml
<field name="docs"><![CDATA[
  <h2>Installation requirements</h2>
  <ul>
    <li>postgres</li>
    <li>python 3.5</li>
    <li>less</li>
    <li>WkHtmlToPdf</li>
  </ul>
]]></field>
```

---

### Ins√©rer une t√¢che

Ajoutez la t√¢che `Reinstall Odoo` √† votre fichier `demo.xml`.  
Ajoutez aussi deux autres t√¢ches avec les statuts `open` et `done`.

Mettez √† jour le `manifest` pour importer ces donn√©es √† l‚Äôinstallation du module.

> üß© Pour tester compl√®tement le fichier `demo.xml`, d√©sinstallez puis r√©installez votre module.

---

## 3. Solutions

Une solution des exercices est disponible ici :  
üëâ [https://git.esi-bru.be/ERPG5/odoo/exercice05](https://git.esi-bru.be/ERPG5/odoo/exercice05)

---

## 4. Pour aller plus loin : Int√©grer un module existant

Un module couramment utilis√© dans Odoo est le module **mail**, qui ajoute des fonctions de messagerie.

### √âtapes

1. Ajoutez la d√©pendance `mail` dans le `manifest`.
2. Modifiez l‚Äôattribut `_inherit` de la classe `TodoTask` avec un second h√©ritage : `mail.thread`.

Ensuite, modifiez la vue formulaire en ajoutant apr√®s la balise `<sheet>` :

```xml
<div class="oe_chatter">
  <field name="message_follower_ids" widget="mail_followers"/>
  <field name="message_ids" widget="mail_thread"/>
</div>
```

Mettez √† jour votre module et v√©rifiez la mise √† jour de la vue formulaire.

*/}