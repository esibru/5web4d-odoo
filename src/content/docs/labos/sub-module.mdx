---
title: Odoo - Cr√©er un sous-module
description: Docs intro
---
import { Aside, FileTree, Tabs, TabItem, } from '@astrojs/starlight/components';

![Description de l'image](../../../assets/work-in-progress.jpeg)


{/* 
# Logique m√©tier, s√©curit√© et sous-module

> **Cours** : Laboratoire de D√©veloppement collaboratif  
> **Ann√©e acad√©mique** : 2022‚Äì2023  
> **Code** : ERPG5  
> **Enseignants** : JLC - SDR  

---

## Consignes g√©n√©rales

Toutes les informations n√©cessaires √† la r√©alisation des exercices sont disponibles dans le cours th√©orique :

- [D√©veloppement d'un module : H√©ritage, Contraintes et Vues Avanc√©es](https://poesi.esi-bru.be/mod/amanote/view.php?id=781)
- [D√©veloppement d'un module : S√©curit√©, Wizard, Rapports et Tests unitaires](https://poesi.esi-bru.be/mod/amanote/view.php?id=782)

Les informations compl√©mentaires sont accessibles via la documentation :

- [Le manifest](https://www.odoo.com/documentation/17.0/developer/reference/backend/module.html)
- [Mod√®le, attributs, m√©thodes](https://www.odoo.com/documentation/17.0/developer/reference/backend/orm.html)
- [Les vues](https://www.odoo.com/documentation/17.0/developer/reference/user_interface/view_records.html)
- [La s√©curit√©](https://www.odoo.com/documentation/17.0/developer/reference/backend/security.html)

---

## 1. Logique m√©tier associ√©e au bouton

### Une nouvelle m√©thode

Dans le fichier `todo_task_model.py`, ajoutez :

```python
from odoo import api
```

Prenez connaissance des d√©corateurs disponibles et expliquez le r√¥le de `@api.depends`.

Ajoutez une m√©thode `do_clear_done` √† la classe `TodoTask` qui met l‚Äôattribut `active` √† `False`.  
Ajoutez un bouton dans la vue formulaire pour appeler cette m√©thode.


### R√©√©crire une m√©thode existante

R√©√©crivez la m√©thode `write` afin d‚Äôactiver automatiquement les t√¢ches inactives lorsqu‚Äôune mise √† jour est effectu√©e.

√âtapes de v√©rification :
1. D√©marrez Odoo
2. Cr√©ez une t√¢che
3. Cliquez sur le bouton **Clear Done**
4. Filtrez les t√¢ches inactives
5. Modifiez le nom de la t√¢che et observez le changement du statut `active`.

### Ajouter des informations dans les logs

Ajoutez l‚Äôimport :

```python
import logging
_logger = logging.getLogger(__name__)
```

Modifiez `do_clear_done` et `write` pour afficher un message dans les logs lorsque le statut `active` change.

> üí° **Astuce** : Vous pouvez afficher `__name__` dans les logs pour comprendre son r√¥le.

### Exception

Ajoutez l‚Äôimport :

```python
from odoo import exceptions
```

Vous pouvez lever des exceptions comme suit :

```python
raise exceptions.Warning('Warning message')
raise exceptions.ValidationError('Not valid message')
```

Ajoutez un `Warning` dans `do_clear_done` si la t√¢che n‚Äôest pas active.

---

## 2. S√©curit√©

Si aucune r√®gle n‚Äôest activ√©e, le log affiche :  
> The model todo.task has no access rules, consider adding one.

### Cr√©er un nouvel utilisateur

Cr√©ez :  
- **Nom** : SpongeBob SquarePants  
- **Email** : SpongeBob@he2b.be  
- **Application Access** : employee  
- **Mot de passe** : pineapple  

Connectez-vous avec ce nouvel utilisateur et constatez qu‚Äôil n‚Äôa pas acc√®s au module.

### Cr√©er un nouveau groupe

Cr√©ez le fichier `security.xml` et ajoutez un groupe nomm√© `carton_caracters`.  
N‚Äôoubliez pas de l‚Äôajouter dans la section `data` du manifest.

Ajoutez SpongeBob au groupe **Cartoon manager** dans :  
`Settings > Users and Companies > Users`


### Donner les acc√®s √† un groupe

Modifiez `security/ir.model.access.csv` pour donner les droits complets au groupe `carton_caracters` sur `todo.task`.

### Cr√©er un utilisateur √† l‚Äôinstallation

Ajoutez l‚Äôutilisateur `Eugene Krabs` dans `security.xml` :

```xml
<record id="task_manager" model="res.users">
  <field name="name">Eugene Krabs</field>
  <field name="email">eugene.krabs@he2b.be</field>
  <field name="password">money</field>
  <field name="login">eugene.krabs@he2b.be</field>
  <field name="employee">True</field>
  <field name="groups_id" eval="[(6,0,[ref('base.group_user'),ref('todo_app.carton_caracters')])]"/>
</record>
```

---

## 3. Cr√©er un sous-module

Cr√©ez un sous-module `todo_stage` d√©pendant du module `todo_app` :

```python
'depends': ['todo_app'],
```

T√©l√©chargez le dossier `static` de PoEsi et placez-le dans votre module.

---

## 4. Cr√©er le mod√®le Tag

Cr√©ez `todo_stage/models/todo_task_tag_model.py` :

```python
class Tag(models.Model):
    _name = "todo.task.tag"
    _description = "To-do Tag"

    name = fields.Char("Tag Name")
```

---

## 5. Ajouter des fonctionnalit√©s √† Task

Cr√©ez `todo_stage/models/todo_task_model.py` :

```python
class TodoTask(models.Model):
    _inherit = "todo.task"
    effort_estimate = fields.Integer("Effort Estimate")
    tag_ids = fields.Many2many("todo.task.tag", string="Tags")
```

Ajoutez la relation inverse dans `Tag` :

```python
task_ids = fields.Many2many("todo.task", string="Tasks")
```

---

## 6. Compl√©ter le mod√®le Task

Ajoutez les champs suivants :

| Nom | Type | Description |
|------|------|-------------|
| `desc` | Char | Description courte |
| `state` | Selection | √âtats : `draft`, `open`, `done` |
| `docs` | Html | Documentation d√©taill√©e |
| `date_created` | Datetime | Date de cr√©ation |
| `image` | Binary | Image associ√©e |

---

## 7. Vue et menus

Cr√©ez `todo_stage/views/todo_menu.xml` et `todo_stage/views/todo_view.xml`.  
Ajoutez le menu et la vue liste des t√¢ches.

Ajoutez un filtre de regroupement par utilisateur via la balise `<filter>`.

---

## 8. Solutions

Les solutions des exercices sont disponibles :  
- [Exercice 02](https://git.esi-bru.be/ERPG5/odoo/exercice02/repository/archive.zip)  
- [Exercice 03](https://git.esi-bru.be/ERPG5/odoo/exercice03)

*/}